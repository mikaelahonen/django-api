packages:
  yum:
    mod24_ssl : []
    
files:
  /etc/httpd/conf.d/ssl.conf:
    mode: "000644"
    owner: root
    group: root
    content: |
      LoadModule wsgi_module modules/mod_wsgi.so
      WSGIPythonHome /opt/python/run/baselinenv
      WSGISocketPrefix run/wsgi
      WSGIRestrictEmbedded On
      Listen 443
      <VirtualHost *:443>
        SSLEngine on
        SSLCertificateFile "/etc/pki/tls/certs/server.crt"
        SSLCertificateKeyFile "/etc/pki/tls/certs/server.key"
        
        Alias /static/ /opt/python/current/app/static/
        <Directory /opt/python/current/app/static>
        Order allow,deny
        Allow from all
        </Directory>
        
        WSGIScriptAlias / /opt/python/current/app/myproject/project/wsgi.py
        
        <Directory /opt/python/current/app>
        Require all granted
        </Directory>
        
        WSGIDaemonProcess wsgi-ssl processes=1 threads=15 display-name=%{GROUP} \
          python-path=/opt/python/run/venv/lib/python3.4/site-packages \
          home=/opt/python/current/app \
          user=wsgi \
          group=wsgi
        WSGIProcessGroup wsgi-ssl
        
      </VirtualHost>
      
  /etc/pki/tls/certs/server.crt:
    mode: "000400"
    owner: root
    group: root
    content: |
      -----BEGIN CERTIFICATE-----
      MIIDpDCCAowCCQDpWAI/q7ACnzANBgkqhkiG9w0BAQsFADCBkzELMAkGA1UEBhMC
      RkkxEjAQBgNVBAgMCVBpcmthbm1hYTEQMA4GA1UEBwwHVGFtcGVyZTEZMBcGA1UE
      CgwQbWlrYWVsYWhvbmVuLmNvbTEZMBcGA1UEAwwQbWlrYWVsYWhvbmVuLmNvbTEo
      MCYGCSqGSIb3DQEJARYZbWlrYWVsLmFob25lbkBob3RtYWlsLmNvbTAeFw0xNzA3
      MjQxMzA5MTRaFw0xODA3MjQxMzA5MTRaMIGTMQswCQYDVQQGEwJGSTESMBAGA1UE
      CAwJUGlya2FubWFhMRAwDgYDVQQHDAdUYW1wZXJlMRkwFwYDVQQKDBBtaWthZWxh
      aG9uZW4uY29tMRkwFwYDVQQDDBBtaWthZWxhaG9uZW4uY29tMSgwJgYJKoZIhvcN
      AQkBFhltaWthZWwuYWhvbmVuQGhvdG1haWwuY29tMIIBIjANBgkqhkiG9w0BAQEF
      AAOCAQ8AMIIBCgKCAQEA2ico9ujGcAiyHc6M+wXFAR4/zh5E4Kwwrl4xQ6RFiL5/
      7Vo3jVZfszAD+ghr7DCCEW9QxVcfWt4sMZZWYGVHuGykja1K2/uN0VnYgflUhAQ0
      RxoqCnOUb1YJtkr64okx/AaUHUctIeeqjg7YgkRAz04QZ6PQ47qM1D/1QUzaIXvC
      Xh3qC3Jh26IFiM/W9R7saWBT9WuN2G1a4s5sEU9Bhnvia0bt40A74WyOa9q5Yyvb
      kAdEyRWzBCcqc8FbO8AHlkdz9mBlFiGI+zESAlE+rQJ3onboRfD5Zra145Anaelf
      fvQCOXds1zdeXkv+h0uXSNNbQnXpiVUiSs2a+hr3JwIDAQABMA0GCSqGSIb3DQEB
      CwUAA4IBAQAtjWNV537OqTb6LAVPKsSvRWnlYVHk0Imwh/G/ptn4uA/Cjdvr9kjq
      st7wqn/QLZmhaHyPT7vSbp5LUO1WRxumjmmu7bL4k0cmqmy1RzcFmWaDSb7m032N
      80tJgQUpdtRHrne32F0kSr+F/xk0OtHpzACI69GvuLnqD56Drj3G4SpfzvYV5w4c
      zkIaWDrKdcuOLLyQ1IVeEJomPgMRnTvhqRxFV19nqHlFp58asa65qRATWp5YHgTn
      eErY37hccerUTdxaOtuXhQeJUKM39TBBbMKMYHtQONvc9jlMqZyXdhmsfreFkqyp
      UIzJpi5ypcpKwu01ehsAfhKhSGwu3OUC
      -----END CERTIFICATE-----
       
  /etc/pki/tls/certs/server.key:
    mode: "000400"
    owner: root
    group: root
    content: |
      -----BEGIN RSA PRIVATE KEY-----
      MIIEpAIBAAKCAQEA2ico9ujGcAiyHc6M+wXFAR4/zh5E4Kwwrl4xQ6RFiL5/7Vo3
      jVZfszAD+ghr7DCCEW9QxVcfWt4sMZZWYGVHuGykja1K2/uN0VnYgflUhAQ0Rxoq
      CnOUb1YJtkr64okx/AaUHUctIeeqjg7YgkRAz04QZ6PQ47qM1D/1QUzaIXvCXh3q
      C3Jh26IFiM/W9R7saWBT9WuN2G1a4s5sEU9Bhnvia0bt40A74WyOa9q5YyvbkAdE
      yRWzBCcqc8FbO8AHlkdz9mBlFiGI+zESAlE+rQJ3onboRfD5Zra145AnaelffvQC
      OXds1zdeXkv+h0uXSNNbQnXpiVUiSs2a+hr3JwIDAQABAoIBAQDD4JeSo83RuK0d
      wGGr3zFV4LBPxbP4vAN1/VNktfJNZyd8mh35RU3mmb1oWvl0eNXBC99NYf3gXE74
      M1HZefcc7EgQgkIOJd/f0zlo8tPlOdUq5p5LBh6InYtY6Bg/IgsEjW+enlMy902Y
      AlJ7HQfIXAK03E1qvQ1IYyk2+ed+WXV+xYyOhL9nnilbk1wjat09Y1FXIa9wxzxm
      /wiSZ6GiHz+sV33IXqEh8puXZgV1WFbBOEwPinMKQ2VGjkeWDQ/DYDYIKQWUmX/N
      nzXAzjTzztf+nHxrUVv+73wN53wUfm5lZLc8uM9obTIQm8hrQgcRQF9ASfcc2dHw
      imPucikxAoGBAPfLolfyasp+jRMf/EGksuBQvxVLrGEQEcZgOolCfh1acJ+6aJgW
      mPnkaLLJglj9+0BbrMq4c3enPRXltyvZ0b84oqUJixwpYJAFuK2er+iqdWxQRh0Q
      IWbPJX1Yl2zDSyoZUgy+ncepRjxHGCOeIvyO31mtTYvLnzOg0otAu7/vAoGBAOFg
      RSHvZjRQ8RPvVXG95nF36h2IYQZx3lyGCwYdKaMgeO9vOpA3pUWUSwdBdpYgKI2f
      2zISGhikwDbERiIWFBsg2M16q12MI7ZIr1YSaH+3oQkEiJ2Mk4/KAzb6t+HGMgcB
      RcMhcvHKCDbdXU9hPJsulNjxTGhYBAcGVG8qBoRJAoGAUcplS6I4nZ4n8qgcG47B
      fEkqyVyxCVjEhTY+HBBWkFnJ0u80lv7ef51k8Z6R583toNChuEgp1NTe1Nt+GntL
      QFLxXIhJ4oHF3cQFsUkvxxx8pcPZYL5yR/0X4sfbM4tCxCKXcp14du7ov/y3ewo3
      giWmk3MgpYQQiHoNBOnZDwECgYAHoKR2U43X821VSWJQ6SZlbLOFsFnoR+5In1i8
      KjyAgtbU86S9wMRdKHmpkzOaPRhiQqi+dxJfByRiNh5RhQHFMUVlHuOx1M5Ymvkk
      JpdWyzYuAfNFsb5EvYeCUtXqVDTZO9fKlNU5Daddg/xmdVoBvn/XH8OAPIpWWoZ9
      BKUX0QKBgQCgzpPrjIWKYlcT3LhvyGHT1cI+dHmyb2qW8olQtvDnXhR1NsShSOKS
      gGK0/Yi2uhgy1+TpQaFNyz08YLt60Y8k1QK1f2JDgdPRaPGaHNeJqLk0yybmB1hG
      yAf5okQWRhanL8rlJdkhTbkvzRwLIk+ApfUB/ixvO0rsApRppU85Qg==
      -----END RSA PRIVATE KEY-----
      
container_commands:
  01killhttpd:
    command: "killall httpd"
  02waitforhttpddeath:
    command: "sleep 3"